<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminMapper">
	
	
	<!-- <resultMap type=" id="">
		<id column="" 							property="" />
		<result column="" 								property="" />
		<result column="" 								property="" />
		<result column="" 							property="" />
	
	</resultMap> -->
	
	 <resultMap type="kh.study.academy.admin.vo.SubjectVO" id="subject">
		<id column="SUBJECT_CODE" 			property="subjectCode" />
		<result column="SUBJECT_NAME" 		property="subjectName" />
		
	</resultMap> 
	
	
	<resultMap type="kh.study.academy.admin.vo.LessonRoomVO" id="lessonRoom">
		<id column="LESSON_ROOM_CODE" 					property="lessonRoomCode" />
		<result column="ROOM_NAME" 						property="roomName" />
		<result column="LESSON_ROOM_MAX_STUDENT" 		property="lessonRoomMaxStudent" />
		<result column="IS_USE" 						property="isUse" />
		
	</resultMap> 




<!-- /////<교시 등록 관련>//////////////////////////////////////////////////////////// -->
	
	
	<!-- 교사리스트 조회 -->
	<!--LESSONS,SUBJECT CODE 수정 필요... -->
	<!-- SUBJECT_NAME 저렇게 할 필요가 없었던 건가...??일단-->
	<select id="selectTeacherList" resultMap="teacherMapper.teacher">
	
		SELECT TEACHER_CODE
			, TEACHER_NAME
			, TEACHER_TELL
			, CAREER
			, TEACHER_ID
			, DECODE(TEACHER_STATUS, 'Y','재직중','퇴사') AS TEACHER_STATUS
			, DECODE(TEACHER_ROLE, 'UNAPPROVED','미승인','교사') AS TEACHER_ROLE
			, LESSONS_CODE
			, SUBJECT_CODE
			, (SELECT SUBJECT_NAME FROM SUBJECT WHERE SUBJECT_CODE = T.SUBJECT_CODE) AS SUBJECT_NAME
		FROM TEACHER T
		
		
	
	</select>
	
	
<!-- /////<과목 등록 관련>//////////////////////////////////////////////////////////// -->
	
	
	<!-- 과목 등록 쿼리문  -->
 	<insert id="insertSubject">
 	
		<selectKey resultType="String" keyProperty="subjectCode" order="BEFORE">
			SELECT 'SUBJECT_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(SUBJECT_CODE, 9))), 0) + 1, 3, 0) 
			FROM SUBJECT
		</selectKey>
	
		INSERT INTO SUBJECT(
			SUBJECT_CODE
			, SUBJECT_NAME
		) VALUES (
			#{subjectCode}
			, #{subjectName}
		)
	</insert> 
		
		
	<!--  등록된 과목 조회  -->	
	<select id="selectSubject" resultMap="subject">
		SELECT SUBJECT_CODE
			, SUBJECT_NAME
		FROM SUBJECT
		ORDER BY SUBJECT_CODE
	</select>
	
	<!-- 등록한 과목을 체크해서 삭제 -->
	<delete id="deleteSubject">
		DELETE SUBJECT
		WHERE SUBJECT_CODE IN
		
		<foreach collection="subjectCodeList" item="subjectCode" separator="," open="(" close=")">
			#{subjectCode}
		</foreach>
	
	</delete>
	
	
<!-- /////<교실 등록 관련>////////////////////////////////////////////////////////// -->
	
	
	<!-- 교실 등록 쿼리문  -->
		<insert id="regLessonRoom">
 		<!-- keyProperty는 내가 select한 LESSON_ROOM_001 ... 코드를 담을 곳
 		 String lessonRoomCode = LESSON_ROOM_001 이라는 뜻-->
		<selectKey resultType="String" keyProperty="lessonRoomCode" order="BEFORE">
			SELECT 'LESSON_ROOM_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(LESSON_ROOM_CODE, 13))), 0) + 1, 3, 0) 
			FROM LESSON_ROOM
		</selectKey>
	
		INSERT INTO LESSON_ROOM(
			LESSON_ROOM_CODE
			, ROOM_NAME
			, LESSON_ROOM_MAX_STUDENT 
			, IS_USE
		) VALUES (
			#{lessonRoomCode}
		    , #{roomName}
		    , #{lessonRoomMaxStudent}
		    , #{isUse}
		)
	</insert> 
	
	<!-- 등록된 교실 조회 -->	
	<select id="selectLessonRoom" resultMap="lessonRoom">
		SELECT LESSON_ROOM_CODE
			, ROOM_NAME
			, LESSON_ROOM_MAX_STUDENT 
			, IS_USE
		FROM LESSON_ROOM
		ORDER BY LESSON_ROOM_CODE 
		
	</select>
	
	
	<!-- 등록한 교실을 체크해서 삭제 -->
		
		<delete id="deleteLessonRoom">
		DELETE LESSON_ROOM
		WHERE LESSON_ROOM_CODE IN
		
		<foreach collection="lessonRoomCodeList" item="lessonRoomCode" separator="," open="(" close=")">
				#{lessonRoomCode}
		</foreach>
	
	</delete>
		


	
</mapper>
























