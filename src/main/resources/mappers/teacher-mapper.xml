<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teacherMapper">
	<resultMap type="kh.study.academy.teacher.vo.TeacherVO" id="teacher">
		<id column="TEACHER_CODE" 							property="teacherCode" />
		<result column="TEACHER_NAME" 						property="teacherName" />
		<result column="TEACHER_TELL" 						property="teacherTell" />
		<result column="CAREER" 							property="career" />
		<result column="TEACHER_ID" 						property="teacherId" />
		<result column="TEACHER_PW" 						property="teacherPw" />
		<result column="WRONG_PW_CNT" 						property="wrongPwCnt" />
		<result column="TEACHER_STATUS" 					property="teacherStatus" />
		<result column="TEACHER_ROLE" 						property="teacherRole" />
		<result column="TEACHER_EMAIL" 						property="teacherEmail" />
		<result column="TEACHER_GENDER" 					property="teacherGender" />
		<result column="TEACHER_BIRTHDAY" 					property="teacherBirthday" />
		
		<!--아래 수정 필요 -->
		<!--LESSONS,SUBJECT 매퍼 만들면 하기...? -->
		<result column="LESSONS_CODE" 						property="lessonsCode" />
		<result column="SUBJECT_CODE" 						property="subjectCode" />
		
		<association property="subjectVO" resultMap="adminMapper.subject"/>
	</resultMap>
	
	
	<!-- 회원가입 -->
	
	<insert id="join">
		<selectKey resultType="String" keyProperty="teacherCode" order="BEFORE">
	         SELECT 'TEACHER_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(TEACHER_CODE, 9))), 0) + 1, 3, 0) 
	         FROM TEACHER  
	      </selectKey>
	
		INSERT INTO TEACHER (
		    TEACHER_CODE
		    , TEACHER_NAME
		    , TEACHER_TELL
		    , CAREER
		    , SUBJECT_CODE
		    , TEACHER_ID
		    , TEACHER_PW
		    , TEACHER_EMAIL
		 
		) VALUES (
			#{teacherCode}
		    , #{teacherName}
		    , #{teacherTell}
		    , #{career}
		    , #{subjectCode}
		    , #{teacherId}
		    , #{teacherPw}
		    , #{teacherEmail}
		)
		
	</insert>
	
	
	<!-- 로그인 -->
	<select id="login" resultMap="teacher">
		SELECT TEACHER_ID
			, TEACHER_PW
			, TEACHER_ROLE
		FROM TEACHER
		WHERE TEACHER_ID =#{teacherId}
	</select>
	
	<!-- 로그인 아이디 정보 찾기  -->
	
	<select id="findId" resultMap="teacher">
	
		SELECT TEACHER_CODE
				,TEACHER_ID
		FROM TEACHER
		WHERE TEACHER_NAME = #{teacherName}
		AND TEACHER_TELL = #{teacherTell}
	
	</select>
	
	<!-- 아이디 중복 검사 -->
	<select id="idDoubleCheck" resultMap="teacher">
		SELECT TEACHER_ID
		FROM TEACHER
		WHERE TEACHER_ID = #{teacherId}
	
	</select>
	
	
	<!-- 개인정보 조회 -->
	<select id="selectTeacherInfo" resultMap="teacher">
		SELECT TEACHER_CODE
			, TEACHER_NAME
			, TEACHER_TELL
			, CAREER
			, SUBJECT_CODE
			, (SELECT SUBJECT_NAME FROM SUBJECT WHERE SUBJECT_CODE = T.SUBJECT_CODE) AS SUBJECT_NAME
			, TEACHER_ID
			, DECODE(TEACHER_STATUS, 'Y','재직중','퇴사') AS TEACHER_STATUS
			, LESSONS_CODE
			, DECODE(TEACHER_ROLE, 'UNAPPROVED', '미승인', 'TEACHER', '교사', 'ADMIN', '관리자') AS TEACHER_ROLE
		FROM TEACHER T
		WHERE TEACHER_ID = #{teacherId}
	</select>

	
		
</mapper>
























